

<mat-card class="customStyle">
    <div class="title-style">
        <mat-card-title>Query Form</mat-card-title>
    </div>
    <mat-card-content class="fl">
        <form [formGroup]="myform"  class="content">
            <div style="font-size: 12px">
                <mat-checkbox class="exist_customer" (change)="check($event.checked)" >Exist Customer
                </mat-checkbox>

                <mat-form-field class="type_customer"  *ngIf="searchFlag==1" appearance="outline">
                    <mat-label>Search Type</mat-label>
                    <mat-select formControlName="search_type" (ngModelChange)="searchType($event)" [(ngModel)]="selected"  >
                        <mat-option *ngFor="let state of searchTypes" [value]="state.id">
                            {{ state.value }}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
               
                <mat-form-field  *ngIf="searchFlag==1" class="search_field" appearance="outline">
                    <input  matInput placeholder="Input Text" [matAutocomplete]="auto" formControlName="search" (keyup)="applySearch($event.target.value)"  />
                    <mat-hint>Searching and selecting field is mandatory</mat-hint>
                </mat-form-field>

                
                <mat-autocomplete  #auto="matAutocomplete" >
                 <span *ngIf="typeFlag==1"> 
                    <mat-option  *ngFor="let option of searchData" (ngModelChange)="onChangeCustomer($event)"  [value]="option.id">
                     
                      <mat-list >
                        <mat-list-item (click)="onChangeCustomer( option.id)">
                            <!-- <span *ngIf="typeFlag==1"> -->
                                {{ option.id }}
                            <!-- </span> -->
                            <!-- <span *ngIf="typeFlag==2">
                            {{ option.name }}
                        </span>
                        <span *ngIf="typeFlag==3">
                            {{ option.email }}
                        </span>
                        <span *ngIf="typeFlag==4">
                            {{ option.phone }}
                        </span> -->
                        </mat-list-item>
                        <mat-divider></mat-divider>
                      </mat-list>
                    </mat-option>
                </span>

                <span *ngIf="typeFlag==2"> 
                    <mat-option  *ngFor="let option of searchData" (ngModelChange)="onChangeCustomer($event)"  [value]="option.name">
                     
                      <mat-list >
                        <mat-list-item (click)="onChangeCustomer( option.id)">
                            {{ option.name }}
                            <!-- <span *ngIf="typeFlag==1"> -->
                                <!-- {{ option.id }} -->
                            <!-- </span> -->
                            <!-- <span *ngIf="typeFlag==2">
                            {{ option.name }}
                        </span>
                        <span *ngIf="typeFlag==3">
                            {{ option.email }}
                        </span>
                        <span *ngIf="typeFlag==4">
                            {{ option.phone }}
                        </span> -->
                        </mat-list-item>
                        <mat-divider></mat-divider>
                      </mat-list>
                    </mat-option>
                </span>

                <span *ngIf="typeFlag==3"> 
                    <mat-option  *ngFor="let option of searchData" (ngModelChange)="onChangeCustomer($event)"  [value]="option.email">
                     
                      <mat-list >
                        <mat-list-item (click)="onChangeCustomer( option.id)">
                            {{ option.email }}
                            <!-- <span *ngIf="typeFlag==1"> -->
                                <!-- {{ option.id }} -->
                            <!-- </span> -->
                            <!-- <span *ngIf="typeFlag==2">
                            {{ option.name }}
                        </span>
                        <span *ngIf="typeFlag==3">
                            {{ option.email }}
                        </span>
                        <span *ngIf="typeFlag==4">
                            {{ option.phone }}
                        </span> -->
                        </mat-list-item>
                        <mat-divider></mat-divider>
                      </mat-list>
                    </mat-option>
                </span>

                <span *ngIf="typeFlag==4"> 
                    <mat-option  *ngFor="let option of searchData" (ngModelChange)="onChangeCustomer($event)"  [value]="option.phone">
                     
                      <mat-list >
                        <mat-list-item (click)="onChangeCustomer( option.id)">
                            {{ option.phone }}
                            <!-- <span *ngIf="typeFlag==1"> -->
                                <!-- {{ option.id }} -->
                            <!-- </span> -->
                            <!-- <span *ngIf="typeFlag==2">
                            {{ option.name }}
                        </span>
                        <span *ngIf="typeFlag==3">
                            {{ option.email }}
                        </span>
                        <span *ngIf="typeFlag==4">
                            {{ option.phone }}
                        </span> -->
                        </mat-list-item>
                        <mat-divider></mat-divider>
                      </mat-list>
                    </mat-option>
                </span>
                  </mat-autocomplete>
              
                  
              
            </div>
  <!-- <div fxLayout="row"  fxLayout.xs="column">
      <div fxFlex="50%" fxFlex.xs="100%">
            <mat-form-field  >
                <input trim="blur" matInput placeholder="Name" formControlName="name" [(ngModel)]="this.name" autocomplete="off" required />
            </mat-form-field>
        </div>
        <div fxFlex="70%" fxFlex.xs="100%">
            <mat-form-field >
                <input matInput placeholder="Phone" formControlName="phone" [(ngModel)]="phone" autocomplete="off" required />
            </mat-form-field>
        </div>
        </div> -->

        <mat-form-field  class="half">
            <input trim="blur" matInput placeholder="Name" formControlName="name" [(ngModel)]="this.name" autocomplete="off" required />
        </mat-form-field>
        <mat-form-field class="half">
            <input matInput placeholder="Phone" formControlName="phone" [(ngModel)]="phone" autocomplete="off" required />
        </mat-form-field>
            <mat-form-field class="half">
                <input matInput placeholder="Email" formControlName="email" [(ngModel)]="email" autocomplete="off"  />
            </mat-form-field>

            <mat-form-field class="half">
                <mat-label>Type</mat-label>
                <mat-select formControlName="type" required [(ngModel)]="type">
                    <mat-option *ngFor="let state of states" [value]="state.value">
                        {{ state.value }}
                    </mat-option>
                </mat-select>
            </mat-form-field>

            <mat-form-field class="half">
                <mat-label>Priority</mat-label>
                <mat-select formControlName="priority" [(ngModel)]="priority" required>
                    <mat-option *ngFor="let state of priorities" [value]="state.value">
                        {{ state.value }}
                    </mat-option>
                </mat-select>
            </mat-form-field>

            <mat-form-field class="half">
                <mat-label>Source</mat-label>
                <mat-select formControlName="source" [(ngModel)]="source" required>
                    <mat-option *ngFor="let state of sources" [value]="state.value">
                        {{ state.value }}
                    </mat-option>
                </mat-select>
            </mat-form-field>


            <mat-form-field class="half">
                <textarea matInput placeholder="Contact Address" formControlName="contact_address" [(ngModel)]="contact_address" autocomplete="off" required></textarea>
            </mat-form-field>

            <mat-form-field class="half">
                <textarea matInput placeholder="Billing Address" formControlName="billing_address" [(ngModel)]="billing_address" autocomplete="off" required></textarea>
            </mat-form-field>




            <div class="full"> Products:</div>
            <div class="product">

                <div formArrayName="products" *ngFor="let assign of myform.get('products')['controls']; let i = index">
                    <div [formArrayName]="i">

                        <mat-form-field class="first" class="quater">
                            <mat-label>Category</mat-label>
                            <mat-select formControlName="category" #sl (ngModelChange)="onChange($event,i)">
                                <input matInput class="filterBox" placeholder="search" autocomplete="off"
                                    (keyup)="applyFilter($event.target.value)" />
                                <a class="closeButton">
                                    <mat-icon (click)="sl.close()">clear</mat-icon>
                                </a>
                                <mat-option *ngFor="let state of categories" [value]="state.id">
                                    {{ state.name }}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>

                        <mat-form-field class="first" class="quater">
                            <mat-label>Model</mat-label>
                            <mat-select formControlName="model" #cl [id]="'model' + i" (ngModelChange)="onChangeModel($event,i)">
                                <input matInput class="filterBox" placeholder="search" autocomplete="off"
                                    (keyup)="applyFilterP($event.target.value)" />
                                <a class="closeButton">
                                    <mat-icon (click)="cl.close()">clear</mat-icon>
                                </a>
                                <mat-option *ngFor="let state of this.productIndex[i]" [value]="state.model_bdcom">
                                    {{ state.model_bdcom }}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>

                        <!-- <mat-form-field class="quater">
                            <input matInput placeholder="model" formControlName="model" autocomplete="off" />
                        </mat-form-field> -->

                        <mat-form-field class="quater">
                            <input matInput placeholder="Quantity" formControlName="quantity" autocomplete="off" />
                        </mat-form-field>

                        <mat-form-field class="quater">
                            <input matInput placeholder="Unit Price" formControlName="price" [id]="'price' + i" [(ngModel)]="unitPriceIndex[i]" autocomplete="off" />
                        </mat-form-field>

                        <mat-checkbox class="checkbox" formControlName="complementary" labelPosition="before">
                            Complementary
                        </mat-checkbox>


                        <span *ngIf="myform.get('products').length >1">
                            <a class="delAssigns">
                                <mat-icon (click)="removeAttributes(i)">clear</mat-icon>
                            </a>
                        </span>


                    </div>

                </div>
                <span class="addbutton">
                    <button (click)="addMoreProducts()" class="back_button" mat-button class=" mat-primary">
                        <mat-icon >add</mat-icon>
                    </button>
                </span>
            </div>

            <div class="full"> <mat-checkbox  (change)="checkMrc($event.checked)" ></mat-checkbox> MRC   </div>             
            <div class="mrc" *ngIf="showMrc">
            <div formArrayName="mrc" *ngFor="let assign of myform.get('mrc')['controls']; let i = index">
                <div [formArrayName]="i">
                    
                        <mat-form-field class="semi">
                            <input matInput placeholder="Title" formControlName="title" autocomplete="off" (ngModelChange)="onCheck($event)"/>
                        </mat-form-field>

                        <mat-form-field class="semi">
                            <input matInput placeholder="Amount" formControlName="amount" autocomplete="off" />
                        </mat-form-field>

                        <span *ngIf="myform.get('mrc').length >1">
                            <a class="delAssigns">
                                <mat-icon (click)="removeMrc(i)">clear</mat-icon>
                            </a>
                        </span>

                        <!-- <button class="back_button" mat-button class=" mat-primary">
                    <mat-icon>add</mat-icon>
                </button> -->
                    </div>

                </div>
                <span class="addbutton">
                    <button (click)="addMoreMrc()" class="back_button" mat-button class=" mat-primary">
                        <mat-icon >add</mat-icon>
                    </button>
                </span>
            </div>

            <div class="full">Files:</div>
            <div class="files">
            <div formArrayName="files" *ngFor="let assign of myform.get('files')['controls']; let i = index">
                <div [formArrayName]="i">
                    
                        <!-- <mat-form-field class="semi">
                            <input matInput placeholder="Type" formControlName="type" autocomplete="off" />
                        </mat-form-field> -->

                        <mat-form-field class="semiType">
                            <mat-label>Type</mat-label>
                            <mat-select formControlName="type" >
                                <mat-option *ngFor="let state of types" [value]="state.value">
                                    {{ state.value }}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                        

                        <img type="hide"  > 
                <mat-label class="image">File </mat-label>
                <input class="image" type="file" formControlName="file" (change)="onFileSelected($event)"
                    enctype="multipart/form-data"  />

                    <a *ngIf="myform.get('files').length >1">
                        <mat-icon (click)="removeFile(i)">clear</mat-icon>
                    </a>
                        <!-- <mat-form-field class="semi">
                            <input matInput placeholder="File" formControlName="file" autocomplete="off" />
                        </mat-form-field> -->

                        <!-- <span class="delbutton" *ngIf="myform.get('files').length >1"> -->
                          
                        <!-- </span> -->

                        <!-- <button class="back_button" mat-button class=" mat-primary">
                    <mat-icon>add</mat-icon>
                </button> -->
                    </div>

                </div>
                <span class="addbutton">
                    <button (click)="addMoreFile()" class="back_button" mat-button class=" mat-primary">
                        <mat-icon >add</mat-icon>
                    </button>
                </span>
            </div>
            <mat-form-field class="full">
                <textarea matInput placeholder="Remarks" formControlName="remarks" autocomplete="off" required></textarea>
            </mat-form-field>

        </form>
    </mat-card-content>

    <mat-card-actions>
        <button class="button" [disabled]="!myform.valid"   mat-stroked-button color="primary" class="btn-block" (click)="addQuery()">
            Submit
        </button>
        <p>Note: Field marked with * is Mandatory</p>
    </mat-card-actions>
</mat-card>